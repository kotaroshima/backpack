(function(){var c,q,r,l,m,n,p,k={}.hasOwnProperty;c=this.Backpack={};c.attach=function(){var a,b,d,c,e;c=arguments[0];d=arguments[1];switch(arguments.length){case 3:a=arguments[2];break;case 4:b=arguments[2],a=_.isString(arguments[3])?b[arguments[3]]:arguments[3]}e=c[d];c[d]=function(){var d;d=e.apply(c,arguments);b||(b=this);a&&a.apply(b,arguments);return d};return{detach:function(){c[d]=e}}};c.defaultPlugins=[];l=function(a,b){var d,h,e;null==b&&(b={});a.plugins=b.plugins||a.plugins;e=_.clone(c.defaultPlugins).concat(a.plugins||
[]);a.setups=[];a.cleanups=[];h={};_.each(e,function(b){var d,c;for(d in b)k.call(b,d)&&(c=b[d],"setup"!==d&&("cleanup"!==d&&"staticProps"!==d)&&(h[d]=c));b.setup&&a.setups.push(b.setup);b.cleanup&&a.cleanups.push(b.cleanup)});for(d in h)k.call(h,d)&&(e=h[d],a[d]||(a[d]=e));for(d in b)k.call(b,d)&&(e=b[d],"plugins"!==d&&"initialize"!==d&&(a[d]=e))};p=function(a){_.each(a.setups,function(b){b.apply(a)})};m=function(a){_.each(a.cleanups,function(b){b.apply(a)})};n=function(a,b){var d,c;d=Backbone.Model.extend.call(this,
a,b);a&&(c=a.plugins)&&(d.prototype.plugins=c,_.each(c,function(a){a.staticProps&&_.extend(d,a.staticProps)}));d.prototype.plugins||(d.prototype.plugins=[]);return d};q=c.Class=function(){this.cid=_.uniqueId("obj");this.initialize.apply(this,arguments)};_.extend(q.prototype,Backbone.Events,{initialize:function(){var a;a=0<arguments.length?arguments[arguments.length-1]:{};l(this,a);p(this);null!=a&&a.initialize&&a.initialize.apply(this,arguments)},destroy:function(){m(this)}});q.extend=n;c.Model=Backbone.Model.extend({initialize:function(a,
b){l(this,b);p(this);null!=b&&b.initialize&&b.initialize.apply(this,arguments)},destroy:function(a){m(this);Backbone.Model.prototype.destroy.apply(this,arguments)}});c.Model.extend=n;c.Collection=Backbone.Collection.extend({initialize:function(a,b){l(this,b);p(this);null!=b&&b.initialize&&b.initialize.apply(this,arguments)},destroy:function(){m(this)}});c.Collection.extend=n;c.View=Backbone.View.extend({initialize:function(a){l(this,a);p(this);null!=a&&a.initialize&&a.initialize.apply(this,arguments)},
delegateEvents:function(a){var b,d,c,e,g,f=this;if(!a&&!(a=_.result(this,"events")))return this;this.undelegateEvents();b=function(a){return _.bind(function(b){return f[a](b)},f)};for(c in a)if(k.call(a,c)&&(g=a[c],this[g]&&_.isFunction(this[g])||_.isFunction(g)))if(e=c.match(/^(\S+)\s*(.*)$/),d=e[1],e=e[2],g=_.isFunction(g)?g:b(g),d+=".delegateEvents"+this.cid,""===e)this.$el.on(d,g);else this.$el.on(d,e,g);return this},remove:function(){m(this);Backbone.View.prototype.remove.apply(this,arguments)},
destroy:function(){this.remove()}});c.View.extend=n;c.AttachPlugin={setup:function(){this._attached=[]},attach:function(){var a;switch(arguments.length){case 2:a=c.attach(this,arguments[0],arguments[1]);break;case 3:a=c.attach(arguments[0],arguments[1],arguments[2])}this._attached.push(a);return a},detach:function(a){var b,d;b=_.indexOf(this._attached,a);d=!1;-1!==b&&(this._attached.splice(b,1),a.detach(),d=!0);return d},cleanup:function(){_.invoke(this._attached,"detach");this._attached=[]}};c.defaultPlugins.push(c.AttachPlugin);
c.ContainerPlugin={setup:function(){this.containerNode||(this.containerNode=this.$el);this.children||(this.children=[]);!1!==this.autoRender&&this.renderContainer()},renderContainer:function(){var a=this;_.each(this.children,function(b){a.addView(b)});return this},getChild:function(a){if(a&&a.cid)return _.find(this.children,function(b){return b===a});if(_.isNumber(a))return this.children[a];if(_.isString(a))return _.find(this.children,function(b){return b.name===a})},addView:function(a,b){var d,c;
c=null!=b?b.at:void 0;d=this.containerNode.find(">*");0<=c&&c<d.length?a.$el.insertBefore(d.eq(c)):this.containerNode.append(a.$el);return a},addChild:function(a,b){var d;d=null!=b?b.at:void 0;0<=d&&d<this.children.length?this.children.splice(d,0,a):this.children.push(a);return this.addView(a,b)},removeChild:function(a,b){var d,c;c=_.isNumber(a)?a:_.indexOf(this.children,a);0<=c&&(d=this.children[c],d.remove(),this.children.splice(c,1),this.onChildRemoved(d));return d},onChildRemoved:function(a){},
clearChildren:function(){var a,b;for(a=b=this.children.length-1;0<=b;a=b+=-1)this.removeChild(a,{silent:!0})},filterChildren:function(a){_.filter(this.children,function(b){b.model.filter(a)?b.$el.show():b.$el.hide()})},cleanup:function(){this.clearChildren()}};c.PublishPlugin={setup:function(){var a,b,d;this._publishers=[];if(this.publishers)for(a in d=this.publishers,d)k.call(d,a)&&(b=d[a],this.addPublisher(a,b))},addPublisher:function(a,b){var d;d=c.attach(this,a,function(){var a;a=[].slice.call(arguments,
0);a.unshift(b);Backbone.trigger.apply(Backbone,a)});this._publishers.push({handler:d,method:a,topic:b});return d},removePublisher:function(){var a,b,d,c,e;a=-1;e=this._publishers;for(b=c=e.length-1;0<=c;b=c+=-1)if(d=e[b],1<arguments.length&&_.isString(arguments[0])){if(arguments[0]===d.method&&arguments[1]===d.topic){a=b;break}}else if(arguments[0]===d.handler){a=b;break}return 0<=a?(this._publishers[a].handler.detach(),this._publishers.splice(a,1),!0):!1},cleanup:function(){_.each(this._publishers,
function(a){a.handler.detach()});this._publishers=[]}};c.defaultPlugins.push(c.PublishPlugin);c.Singleton={setup:function(){var a=this;if(_.find(c._singletons,function(b){return b.constructor===a.constructor}))throw Error("Only single instance can be initialized");c._singletons||(c._singletons=[]);c._singletons.push(this)},staticProps:{getInstance:function(){var a,b=this;(a=_.find(c._singletons,function(a){return a.constructor===b}))||(a=new this);return a}}};c.SortablePlugin={setup:function(){!1!==
this.sortable&&this.setSortable(!0)},_getSortableContainer:function(){return this.containerNode||this.$el},setSortable:function(a){var b,d=this;b=this._getSortableContainer();a?this._sortableInit?b.sortable("enable"):(a={start:function(a,b){b.item.startIndex=b.item.index()},stop:function(a,b){var c,f,k,l;c=d.collection;f=c.at(b.item.startIndex);l=b.item.index();k=c.models;k.splice(b.item.startIndex,1);k.splice(l,0,f);c.reset(k);a.stopPropagation()}},this.sortableOptions&&(a=_.extend(a,this.sortableOptions)),
b.sortable(a),this._sortableInit=!0):this._sortableInit&&b.sortable("disable")},cleanup:function(){this._sortableInit&&this._getSortableContainer().sortable("destroy")}};c.SubscribePlugin={setup:function(){var a,b,d;this._subscribers=[];if(this.subscribers)for(a in d=this.subscribers,d)k.call(d,a)&&(b=d[a],this.addSubscriber(a,b))},addSubscriber:function(a,b){_.isString(b)&&(b=this[b]);this._subscribers.push({topic:a,callback:b});return Backbone.on(a,b,this)},removeSubscriber:function(a,b){var d,
c,e,g,f;_.isString(b)&&(b=this[b]);d=-1;f=this._subscribers;for(c=g=f.length-1;0<=g;c=g+=-1)if(e=f[c],a===e.topic&&b===e.callback){d=c;break}return 0<=d?(-1!==d&&this._subscribers.splice(d,1),Backbone.off(a,b,this),!0):!1},cleanup:function(){var a=this;_.each(this._subscribers,function(b){return Backbone.off(b.topic,b.callback,a)});this._subscribers=[]}};c.defaultPlugins.push(c.SubscribePlugin);c.TemplatePlugin={setup:function(){var a,b,d;if(this.model)this.model.on("change",this.renderTemplate,this);
this.renderTemplate();if(this.templateNodes)for(a in d=this.templateNodes,d)k.call(d,a)&&(b=d[a],this[a]=this.$(b))},renderTemplate:function(){var a;a=this.template;_.isFunction(a)&&(a=a(this.model?this.model.attributes:this.options));this.$el.html(a)},cleanup:function(){this.model&&this.model.off("change",this.renderTemplate)}};c.ActionView=c.View.extend({plugins:[c.TemplatePlugin],template:_.template('<%= leftActionHtml %><span class="main-cell"><%= text %></span><%= rightActionHtml %>'),templateNodes:{mainCell:".main-cell"},
initialize:function(a){var b,d,h,e;this.$el.addClass("action-view");this.events||(this.events={});if(b=a.actions||this.actions)(h=b.left)&&(d=this._processActions(h,!0)),(b=_.isArray(b)?b:b.right)&&(e=this._processActions(b,!1));_.defaults(this.options,{leftActionHtml:d||"",rightActionHtml:e||"",text:""});c.View.prototype.initialize.apply(this,arguments);this.delegateEvents(this.events);a.itemView&&(this.itemView=a.itemView);a.itemOptions&&(this.itemOptions=a.itemOptions)},_buttonTemplate:_.template('<<%- tagName %> class="<%- iconClass %>" title="<%- title %>"><%- text %></<%- tagName %>>'),
_processActions:function(a,b){var d,c=this;d='<span class="'+(b?"left-cell":"right-cell")+'">';_.each(a,function(a){var b,f;b=a.iconClass;if(f=a.onClick)_.isString(f)&&(f=c[f]),f&&_.isFunction(f)&&(c.events["click ."+b]=_.bind(f,c));a=_.defaults(a,{tagName:f?"button":"span",iconClass:"",title:"",text:""});d+=c._buttonTemplate(a)});return d+="</span>"},render:function(a){var b;this.itemView?(this.child||(b=this.child=new this.itemView(this.itemOptions),this.mainCell.append(b.$el)),b.render()):this.mainCell.text(a?
a.text:"");return this},destroy:function(){this.itemView&&this.itemView.destroy&&this.child.destroy();c.View.prototype.destroy(this,arguments)}});c.StackView=c.View.extend({plugins:[c.ContainerPlugin],effects:{HIDE_BACKWARD:["slide",{direction:"right"},"slow"],HIDE_FORWARD:["slide",{direction:"left"},"slow"],SHOW_BACKWARD:["slide",{direction:"left"},"slow"],SHOW_FORWARD:["slide",{direction:"right"},"slow"]},initialize:function(a){var b,d=this;null==a&&(a={});c.View.prototype.initialize.apply(this,
arguments);this.$el.css({position:"relative",width:"100%"});this.attach("addView",function(a,b){!0===(null!=b?b.showOnAdd:void 0)&&d.showChild(a,!0)});b=a.showIndex||0;this.children&&(0<=b&&b<this.children.length)&&(this._previousView=this._currentView=this.children[b]);this.render()},render:function(){this.showChild(this._currentView,!0);return this},addView:function(a,b){var d,h=this;a.$el.css({position:"absolute",width:"99%"});c.ContainerPlugin.addView.apply(this,arguments);if(d=this.navigationEvents)if(d=
d[a.name])d=_.isArray(d)?d:[d],_.each(d,function(b){h.attachNavigationEvent(a,b)});a.$el.hide()},addChild:function(a,b){0===this.children.length&&(b||(b={}),b.showOnAdd=!0);return c.ContainerPlugin.addChild.apply(this,[a,b])},removeChild:function(a){var b;a=this.getChild(a);a===this._currentView&&(b=_.indexOf(this.children,a),0<b?this.showChild(this.getChild(b-1),!0):this._previousView=this._currentView=null);return c.ContainerPlugin.removeChild.apply(this,arguments)},attachNavigationEvent:function(a,
b){var d,c=this;!0===b.back?a.attach(a,b.event,function(){c.onBack()}):b.target&&(d=_.find(this.children,function(a){return a.name===b.target}),a.attach(a,b.event,function(){c.showChild(d)}))},onBack:function(){this.showPreviousChild()},showChild:function(a,b){var d,c,e;a=this.getChild(a);d=_.indexOf(this.children,a)<_.indexOf(this.children,this._currentView);this._currentView&&(b||(c=this.effects[d?"HIDE_BACKWARD":"HIDE_FORWARD"]),this._currentView.$el.hide.apply(this._currentView.$el,c));b||(e=
this.effects[d?"SHOW_BACKWARD":"SHOW_FORWARD"]);a.$el.show.apply(a.$el,e);this._previousView=this._currentView;return this._currentView=a},showPreviousChild:function(){this._previousView&&this.showChild(this._previousView)}});c.ListView=c.View.extend({plugins:[c.TemplatePlugin,c.ContainerPlugin],messages:{NO_ITEMS:"No Items"},template:'<div class="main-node"><div class="container-node"></div><div class="message-node"></div></div><div class="loading-node">Loading...</div>',templateNodes:{containerNode:".container-node",
messageNode:".message-node",mainNode:".main-node",loadingNode:".loading-node"},itemView:c.View,initialize:function(a){var b,d=this;this.$el.addClass("list-view");a.itemView&&(this.itemView=a.itemView);c.View.prototype.initialize.apply(this,arguments);this.setLoading(!1);b=this.collection;b.on("reset",this.render,this);b._onAddModel=function(a,b,c){d.renderModel(a,c)};b.on("add",b._onAddModel);this.render()},render:function(){var a=this;this.toggleContainerNode(0<this.collection.models.length,this.messages.NO_ITEMS);
this.clearChildren();_.each(this.collection.models,function(b){a.renderModel(b,{silent:!0})});return this},toggleContainerNode:function(a,b){var d,c;c=this.messageNode;d=this.containerNode;a?(c.hide(),d.show()):(c.html(b),c.show(),d.hide())},renderModel:function(a,b){var d,c=this;d=this.createChild(a);a._onModelDestroy=function(){c.removeChild(d);a.off("destroy")};a.on("destroy",a._onModelDestroy);this.addChild(d,b);null!=b&&b.silent||this.toggleContainerNode(0<this.collection.models.length,this.messages.NO_ITEMS);
return d},createChild:function(a){return(new this.itemView(_.extend(this.itemOptions||{},{model:a}))).render()},removeChild:function(a,b){var d=this;a=this.getChild(a);!0===(null!=b?b.silent:void 0)?c.ContainerPlugin.removeChild.call(this,a):a.$el.hide("slide",{direction:"left"},"fast",function(){c.ContainerPlugin.removeChild.call(d,a);d.toggleContainerNode(0<d.collection.models.length,d.messages.NO_ITEMS)});return a},clearChildren:function(){_.each(this.collection.models,function(a){a._onModelDestroy&&
a.off("destroy",a._onModelDestroy)});c.ContainerPlugin.clearChildren.apply(this,arguments)},setLoading:function(a){a?(this.loadingNode.show(),this.mainNode.hide()):(this.loadingNode.hide(),this.mainNode.show())},destroy:function(){var a;this.clearChildren();a=this.collection;a.off("reset",this.render);a.off("add",a._onAddModel);c.View.prototype.destroy.apply(this,arguments)}});r=c.ActionView.extend({actions:{left:[{iconClass:"delete-icon",title:"Confirm delete",onClick:"onRemoveConfirmButtonClick"}],
right:[{iconClass:"reorder-handle",title:"Reorder"},{iconClass:"delete-button",title:"Delete",text:"Delete",onClick:"onRemoveButtonClick"}]},onRemoveConfirmButtonClick:function(a){var b;b=this.$el.hasClass("remove-confirm");this.$el.toggleClass("remove-confirm",!b);a.stopPropagation()},onRemoveButtonClick:function(a){this.child.model.destroy();a.stopPropagation()}});c.EditableListView=c.ListView.extend({plugins:[c.TemplatePlugin,c.ContainerPlugin,c.SortablePlugin],sortableOptions:{handle:".reorder-handle"},
initialize:function(a){this.$el.addClass("editable-list-view");c.ListView.prototype.initialize.apply(this,arguments);this.setEditable(!0===a.editable||!1)},setEditable:function(a){this.setSortable(a);this.containerNode.toggleClass("listview-edit",a)},createChild:function(a){return(new r({itemView:this.itemView,itemOptions:_.extend(this.itemOptions||{},{model:a})})).render()}});c.TabButtonView=c.View.extend({tagName:"a",attributes:{href:"#","class":"tab-button"},plugins:[c.TemplatePlugin],template:_.template("<%- title %>"),
events:{click:"onClick"},onClick:function(a){}});c.TabView=c.StackView.extend({plugins:[c.TemplatePlugin,c.ContainerPlugin],template:'<div class="tab-button-container"></div><div class="tab-content-container"></div>',templateNodes:{containerNode:".tab-content-container"},autoRender:!1,render:function(){this._buttonMap={};this.buttonContainer=new c.View({el:".tab-button-container",plugins:[c.ContainerPlugin]});this.renderContainer();c.StackView.prototype.render.apply(this,arguments);return this},addView:function(a,
b){var d,h;c.StackView.prototype.addView.apply(this,arguments);h=this;d=new c.TabButtonView({title:a.title||a.name,onClick:function(a){h.showChild(this._tabContentView)}});this.buttonContainer.addChild(d);this._buttonMap[a.cid]=d;d._tabContentView=a},removeChild:function(a){var b,d;if(b=c.StackView.prototype.removeChild.apply(this,arguments))d=this._buttonMap[b.cid],this.buttonContainer.removeChild(d),d.destroy(),delete this._buttonMap[b.cid];return b},showChild:function(a){var b;if(a=c.StackView.prototype.showChild.apply(this,
[a,!0]))b=this._buttonMap,this._previousView&&b[this._previousView.cid].$el.removeClass("selected"),b[a.cid].$el.addClass("selected");return a}});c.GoogleMapView=c.View.extend({apiKey:"",defaultLocation:{lat:-34.397,lng:150.644},subscribers:{GOOGLE_MAP_SCRIPT_LOADED:"_onScriptLoaded"},initialize:function(a){c.View.prototype.initialize.apply(this,arguments);a.el||this.$el.css({width:"100%",height:"100%"})},initMap:function(){var a;if(!this.apiKey||0===this.apiKey.length)throw Error("You need Google Map API key to use this widget");
this._mapInit||(a=document.createElement("script"),a.type="text/javascript",a.src="http://maps.googleapis.com/maps/api/js?sensor=true&callback=Backpack.GoogleMapView.onScriptLoaded&key="+this.apiKey,document.body.appendChild(a),this._mapInit=!0)},_onScriptLoaded:function(){this.map=new google.maps.Map(this.$el.get(0),{zoom:8,center:new google.maps.LatLng(this.defaultLocation.lat,this.defaultLocation.lng),mapTypeId:google.maps.MapTypeId.ROADMAP});this.removeSubscriber("GOOGLE_MAP_SCRIPT_LOADED",this._onScriptLoaded)},
setLocation:function(a){this.map.panTo(new google.maps.LatLng(a.lat,a.lng))},addMarker:function(a){(new google.maps.Marker({position:new google.maps.LatLng(a.lat,a.lng),title:a.title})).setMap(this.map)}});c.GoogleMapView.onScriptLoaded=function(){Backbone.trigger("GOOGLE_MAP_SCRIPT_LOADED")}}).call(this);
