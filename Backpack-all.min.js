(function(){var a,b,c,d,e,f,g,h,i,j,k={}.hasOwnProperty;i=this,a=i.Backpack={},a.attach=function(){var a,b,c,d,e;switch(d=arguments[0],c=arguments[1],arguments.length){case 3:a=arguments[2];break;case 4:b=arguments[2],a=_.isString(arguments[3])?b[arguments[3]]:arguments[3]}return e=d[c],d[c]=function(){var c;return c=e.apply(d,arguments),b||(b=this),a&&a.apply(b,arguments),c},{detach:function(){d[c]=e}}},a.defaultPlugins=[],f=function(b,c){var d,e,f,g;null==c&&(c={}),c.allPlugins?f=c.allPlugins:(f=b.allPlugins||[],c.plugins&&(f=f.concat(c.plugins))),f=_.clone(a.defaultPlugins).concat(f),b.setups=[],b.cleanups=[],e={},_.each(f,function(a){var c,d;for(c in a)k.call(a,c)&&(d=a[c],"setup"!==c&&"cleanup"!==c&&"staticProps"!==c&&(e[c]=d));a.setup&&b.setups.push(a.setup),a.cleanup&&b.cleanups.push(a.cleanup)});for(d in e)k.call(e,d)&&(g=e[d],b[d]||(b[d]=g));for(d in c)k.call(c,d)&&(g=c[d],"plugins"!==d&&"initialize"!==d&&(b[d]=g))},j=function(a){_.each(a.setups,function(b){b.apply(a)})},g=function(a){_.each(a.cleanups,function(b){b.apply(a)})},h=function(a,b){var c,d;return c=Backbone.Model.extend.call(this,a,b),a&&(d=a.allPlugins,d?c.prototype.allPlugins=d:(d=a.plugins,d&&(c.prototype.allPlugins=c.prototype.allPlugins?c.prototype.allPlugins.concat(d):d)),d&&_.each(d,function(a){a.staticProps&&_.extend(c,a.staticProps)})),c.prototype.plugins||(c.prototype.plugins=[]),c},d=a.Class=function(){this.cid=_.uniqueId("obj"),this.initialize.apply(this,arguments)},_.extend(d.prototype,Backbone.Events,{initialize:function(){var a;a=arguments.length>0?arguments[arguments.length-1]:{},f(this,a),j(this),(null!=a?a.initialize:void 0)&&a.initialize.apply(this,arguments)},destroy:function(){g(this)}}),d.extend=h,a.Model=Backbone.Model.extend({initialize:function(a,b){f(this,b),j(this),(null!=b?b.initialize:void 0)&&b.initialize.apply(this,arguments)},destroy:function(){g(this),Backbone.Model.prototype.destroy.apply(this,arguments)}}),a.Model.extend=h,a.Collection=Backbone.Collection.extend({initialize:function(a,b){f(this,b),j(this),(null!=b?b.initialize:void 0)&&b.initialize.apply(this,arguments)},destroy:function(){g(this)}}),a.Collection.extend=h,a.View=Backbone.View.extend({initialize:function(a){f(this,a),j(this),(null!=a?a.initialize:void 0)&&a.initialize.apply(this,arguments)},delegateEvents:function(a){var b,c,d,e,f,g,h,i=this;if(!a&&!(a=_.result(this,"events")))return this;this.undelegateEvents(),b=function(a){var b;return b=function(b){return i[a](b)},_.bind(b,i)};for(d in a)k.call(a,d)&&(g=a[d],(this[g]&&_.isFunction(this[g])||_.isFunction(g))&&(e=d.match(/^(\S+)\s*(.*)$/),c=e[1],h=e[2],f=_.isFunction(g)?g:b(g),c+=".delegateEvents"+this.cid,""===h?this.$el.on(c,f):this.$el.on(c,h,f)));return this},remove:function(){g(this),Backbone.View.prototype.remove.apply(this,arguments)},destroy:function(){this.remove()}}),a.View.extend=h,a.AttachPlugin={setup:function(){this._attached=[]},attach:function(){var b;switch(arguments.length){case 2:b=a.attach(this,arguments[0],arguments[1]);break;case 3:b=a.attach(arguments[0],arguments[1],arguments[2])}return this._attached.push(b),b},detach:function(a){var b,c;return b=_.indexOf(this._attached,a),c=!1,-1!==b&&(this._attached.splice(b,1),a.detach(),c=!0),c},cleanup:function(){_.invoke(this._attached,"detach"),this._attached=[]}},a.defaultPlugins.push(a.AttachPlugin),a.ContainerPlugin={setup:function(){var a;a=this.containerNode,a||(this.containerNode=this.$el),this.children||(this.children=[]),this.autoRender!==!1&&this.renderContainer()},renderContainer:function(){var a=this;return _.each(this.children,function(b){a.addView(b)}),this},getChild:function(a){return a&&a.cid?_.find(this.children,function(b){return b===a}):_.isNumber(a)?this.children[a]:_.isString(a)?_.find(this.children,function(b){return b.name===a}):null},addView:function(a,b){var c,d;return d=null!=b?b.at:void 0,c=this.containerNode.find(">*"),d>=0&&d<c.length?a.$el.insertBefore(c.eq(d)):this.containerNode.append(a.$el),a},addChild:function(a,b){var c;return c=null!=b?b.at:void 0,c>=0&&c<this.children.length?this.children.splice(c,0,a):this.children.push(a),this.addView(a,b)},removeChild:function(a){var b,c;return c=_.isNumber(a)?a:_.indexOf(this.children,a),c>=0&&(b=this.children[c],b.remove(),this.children.splice(c,1),this.onChildRemoved(b)),b},onChildRemoved:function(){},clearChildren:function(){var a,b,c;for(a=b=c=this.children.length-1;b>=0;a=b+=-1)this.removeChild(a,{silent:!0})},filterChildren:function(a){_.filter(this.children,function(b){b.model.filter(a)?b.$el.show():b.$el.hide()})},cleanup:function(){this.clearChildren()}},a.PublishPlugin={setup:function(){var a,b,c;if(this._publishers=[],this.publishers){c=this.publishers;for(a in c)k.call(c,a)&&(b=c[a],this.addPublisher(a,b))}},addPublisher:function(b,c){var d;return d=a.attach(this,b,function(){var a;a=[].slice.call(arguments,0),a.unshift(c),Backbone.trigger.apply(Backbone,a)}),this._publishers.push({handler:d,method:b,topic:c}),d},removePublisher:function(){var a,b,c,d,e;for(a=-1,e=this._publishers,b=d=e.length-1;d>=0;b=d+=-1)if(c=e[b],arguments.length>1&&_.isString(arguments[0])){if(arguments[0]===c.method&&arguments[1]===c.topic){a=b;break}}else if(arguments[0]===c.handler){a=b;break}return a>=0?(this._publishers[a].handler.detach(),this._publishers.splice(a,1),!0):!1},cleanup:function(){_.each(this._publishers,function(a){a.handler.detach()}),this._publishers=[]}},a.defaultPlugins.push(a.PublishPlugin),a.Singleton={setup:function(){var b,c=this;if(b=_.find(a._singletons,function(a){return a.constructor===c.constructor}))throw new Error("Only single instance can be initialized");a._singletons||(a._singletons=[]),a._singletons.push(this)},staticProps:{getInstance:function(){var b,c=this;return b=_.find(a._singletons,function(a){return a.constructor===c}),b||(b=new this),b}}},a.SortablePlugin={setup:function(){this.sortable!==!1&&this.setSortable(!0)},_getSortableContainer:function(){return this.containerNode||this.$el},setSortable:function(a){var b,c,d=this;b=this._getSortableContainer(),a?this._sortableInit?b.sortable("enable"):(c={start:function(a,b){b.item.startIndex=b.item.index()},stop:function(a,b){var c,e,f,g;c=d.collection,e=c.at(b.item.startIndex),g=b.item.index(),f=c.models,f.splice(b.item.startIndex,1),f.splice(g,0,e),c.reset(f),a.stopPropagation()}},this.sortableOptions&&(c=_.extend(c,this.sortableOptions)),b.sortable(c),this._sortableInit=!0):this._sortableInit&&b.sortable("disable")},cleanup:function(){this._sortableInit&&this._getSortableContainer().sortable("destroy")}},a.SubscribePlugin={setup:function(){var a,b,c;if(this._subscribers=[],this.subscribers){c=this.subscribers;for(a in c)k.call(c,a)&&(b=c[a],this.addSubscriber(a,b))}},addSubscriber:function(a,b){return _.isString(b)&&(b=this[b]),this._subscribers.push({topic:a,callback:b}),Backbone.on(a,b,this)},removeSubscriber:function(a,b){var c,d,e,f,g;for(_.isString(b)&&(b=this[b]),c=-1,g=this._subscribers,d=f=g.length-1;f>=0;d=f+=-1)if(e=g[d],a===e.topic&&b===e.callback){c=d;break}return c>=0?(-1!==c&&this._subscribers.splice(c,1),Backbone.off(a,b,this),!0):!1},cleanup:function(){var a=this;_.each(this._subscribers,function(b){return Backbone.off(b.topic,b.callback,a)}),this._subscribers=[]}},a.defaultPlugins.push(a.SubscribePlugin),a.TemplatePlugin={setup:function(){var a,b,c;if(this.model&&this.model.on("change",this.renderTemplate,this),this.renderTemplate(),this.templateNodes){c=this.templateNodes;for(a in c)k.call(c,a)&&(b=c[a],this[a]=this.$(b))}},renderTemplate:function(){var a;a=this.template,_.isFunction(a)&&(a=a(this.model?this.model.attributes:this.options)),this.$el.html(a)},cleanup:function(){this.model&&this.model.off("change",this.renderTemplate)}},a.ActionView=a.View.extend({plugins:[a.TemplatePlugin],template:_.template('<%= leftActionHtml %><span class="main-cell"><%= text %></span><%= rightActionHtml %>'),templateNodes:{mainCell:".main-cell"},initialize:function(b){var c,d,e,f,g;this.$el.addClass("action-view"),this.events||(this.events={}),c=b.actions||this.actions,c&&(e=c.left,e&&(d=this._processActions(e,!0)),g=_.isArray(c)?c:c.right,g&&(f=this._processActions(g,!1))),_.defaults(this.options,{leftActionHtml:d||"",rightActionHtml:f||"",text:""}),a.View.prototype.initialize.apply(this,arguments),this.delegateEvents(this.events),b.itemView&&(this.itemView=b.itemView),b.itemOptions&&(this.itemOptions=b.itemOptions)},_buttonTemplate:_.template('<<%- tagName %> class="<%- iconClass %>" title="<%- title %>"><%- text %></<%- tagName %>>'),_processActions:function(a,b){var c,d=this;return c='<span class="'+(b?"left-cell":"right-cell")+'">',_.each(a,function(a){var b,e;b=a.iconClass,e=a.onClick,e&&(_.isString(e)&&(e=d[e]),e&&_.isFunction(e)&&(d.events["click ."+b]=_.bind(e,d))),a=_.defaults(a,{tagName:e?"button":"span",iconClass:"",title:"",text:""}),c+=d._buttonTemplate(a)}),c+="</span>"},render:function(a){var b;return this.itemView?(this.child||(b=this.child=new this.itemView(this.itemOptions),this.mainCell.append(b.$el)),b.render()):this.mainCell.text(a?a.text:""),this},destroy:function(){this.itemView&&this.itemView.destroy&&this.child.destroy(),a.View.prototype.destroy(this,arguments)}}),a.StackView=a.View.extend({plugins:[a.ContainerPlugin],effects:{HIDE_BACKWARD:["slide",{direction:"right"},"slow"],HIDE_FORWARD:["slide",{direction:"left"},"slow"],SHOW_BACKWARD:["slide",{direction:"left"},"slow"],SHOW_FORWARD:["slide",{direction:"right"},"slow"]},initialize:function(b){var c,d=this;null==b&&(b={}),a.View.prototype.initialize.apply(this,arguments),this.$el.css({position:"relative"}),this.attach("addView",function(a,b){(null!=b?b.showOnAdd:void 0)===!0&&d.showChild(a,!0)}),c=b.showIndex||0,this.children&&c>=0&&c<this.children.length&&(this._currentView=this.children[c],this._previousView=this._currentView),this.render()},render:function(){return this.showChild(this._currentView,!0),this},addView:function(b){var c,d,e,f=this;b.$el.css({position:"absolute",width:"99%"}),a.ContainerPlugin.addView.apply(this,arguments),d=this.navigationEvents,d&&(e=d[b.name],e&&(c=_.isArray(e)?e:[e],_.each(c,function(a){f.attachNavigationEvent(b,a)}))),b.$el.hide()},addChild:function(b,c){return 0===this.children.length&&(c||(c={}),c.showOnAdd=!0),a.ContainerPlugin.addChild.apply(this,[b,c])},removeChild:function(b){var c,d;return b=this.getChild(b),b===this._currentView&&(d=_.indexOf(this.children,b),this.children.length>1?d>0?c=this.getChild(d-1,!0):0===d&&(c=this.getChild(1,!0)):c=null,this.showChild(c,!0)),a.ContainerPlugin.removeChild.apply(this,arguments)},attachNavigationEvent:function(a,b){var c,d=this;b.back===!0?a.attach(a,b.event,function(){d.onBack()}):b.target&&(c=_.find(this.children,function(a){return a.name===b.target}),a.attach(a,b.event,function(){d.showChild(c)}))},onBack:function(){this.showPreviousChild()},showChild:function(a,b){var c,d,e,f,g;return a=this.getChild(a),c=_.indexOf(this.children,a)<_.indexOf(this.children,this._currentView),this._currentView&&(e=c?"HIDE_BACKWARD":"HIDE_FORWARD",b||(d=this.effects[e]),this._currentView.$el.hide.apply(this._currentView.$el,d)),a&&(g=c?"SHOW_BACKWARD":"SHOW_FORWARD",b||(f=this.effects[g]),a.$el.show.apply(a.$el,f)),this._previousView=this._currentView,this._currentView=a},showPreviousChild:function(){this._previousView&&this.showChild(this._previousView)}}),a.ListView=a.View.extend({plugins:[a.TemplatePlugin,a.ContainerPlugin],messages:{NO_ITEMS:"No Items"},template:'<div class="main-node"><div class="container-node"></div><div class="message-node"></div></div><div class="loading-node">Loading...</div>',templateNodes:{containerNode:".container-node",messageNode:".message-node",mainNode:".main-node",loadingNode:".loading-node"},itemView:a.View,initialize:function(b){var c,d=this;this.$el.addClass("list-view"),b.itemView&&(this.itemView=b.itemView),a.View.prototype.initialize.apply(this,arguments),this.setLoading(!1),c=this.collection,c.on("reset",this.render,this),c._onAddModel=function(){d.renderModel(arguments[0],arguments[2])},c.on("add",c._onAddModel),this.render()},render:function(){var a=this;return this.toggleContainerNode(this.collection.models.length>0,this.messages.NO_ITEMS),this.clearChildren(),_.each(this.collection.models,function(b){a.renderModel(b,{silent:!0})}),this},toggleContainerNode:function(a,b){var c,d;d=this.messageNode,c=this.containerNode,a?(d.hide(),c.show()):(d.html(b),d.show(),c.hide())},renderModel:function(a,b){var c,d=this;return c=this.createChild(a),a._onModelDestroy=function(){d.removeChild(c),a.off("destroy")},a.on("destroy",a._onModelDestroy),this.addChild(c,b),(null!=b?b.silent:void 0)||this.toggleContainerNode(this.collection.models.length>0,this.messages.NO_ITEMS),c},createChild:function(a){var b,c;return c=this.itemOptions||{},b=new this.itemView(_.extend(c,{model:a})),b.render()},removeChild:function(b,c){var d=this;return b=this.getChild(b),(null!=c?c.silent:void 0)===!0?a.ContainerPlugin.removeChild.call(this,b):b.$el.hide("slide",{direction:"left"},"fast",function(){a.ContainerPlugin.removeChild.call(d,b),d.toggleContainerNode(d.collection.models.length>0,d.messages.NO_ITEMS)}),b},clearChildren:function(){_.each(this.collection.models,function(a){a._onModelDestroy&&a.off("destroy",a._onModelDestroy)}),a.ContainerPlugin.clearChildren.apply(this,arguments)},setLoading:function(a){a?(this.loadingNode.show(),this.mainNode.hide()):(this.loadingNode.hide(),this.mainNode.show())},destroy:function(){var b;this.clearChildren(),b=this.collection,b.off("reset",this.render),b.off("add",b._onAddModel),a.View.prototype.destroy.apply(this,arguments)}}),b="listview-edit",c="remove-confirm",e=a.ActionView.extend({actions:{left:[{iconClass:"delete-icon",title:"Confirm delete",onClick:"onRemoveConfirmButtonClick"}],right:[{iconClass:"reorder-handle",title:"Reorder"},{iconClass:"delete-button",title:"Delete",text:"Delete",onClick:"onRemoveButtonClick"}]},onRemoveConfirmButtonClick:function(a){var b;b=this.$el.hasClass(c),this.$el.toggleClass(c,!b),a.stopPropagation()},onRemoveButtonClick:function(a){this.child.model.destroy(),a.stopPropagation()}}),a.EditableListView=a.ListView.extend({plugins:[a.SortablePlugin],sortableOptions:{handle:".reorder-handle"},initialize:function(b){this.$el.addClass("editable-list-view"),a.ListView.prototype.initialize.apply(this,arguments),this.setEditable(b.editable===!0||!1)},setEditable:function(a){this.setSortable(a),this.containerNode.toggleClass(b,a)},createChild:function(a){var b,c;return b=this.itemOptions||{},c=new e({itemView:this.itemView,itemOptions:_.extend(b,{model:a})}),c.render()}}),a.TabButtonView=a.View.extend({tagName:"a",attributes:{href:"#","class":"tab-button"},plugins:[a.TemplatePlugin],template:_.template("<%- text %>")}),a.TabView=a.StackView.extend({allPlugins:[a.TemplatePlugin,a.ContainerPlugin],template:'<div class="tab-button-container"></div><div class="tab-content-container"></div>',templateNodes:{containerNode:".tab-content-container"},autoRender:!1,render:function(){return this._buttonMap={},this.buttonContainer=new a.View({el:".tab-button-container",plugins:[a.ContainerPlugin]}),this.renderContainer(),a.StackView.prototype.render.apply(this,arguments),this},addView:function(b,c){var d,e;a.StackView.prototype.addView.apply(this,arguments),c={text:b.title||b.name,tabView:this,onClick:function(){this.tabView.showChild(this._tabContentView)}},_.extend(c,this.tabButtonOptions),c.events||(c.events={}),c.events.click="onClick",d=this.tabButtonView||a.TabButtonView,e=new d(c),this.buttonContainer.addChild(e),this._buttonMap[b.cid]=e,e._tabContentView=b},removeChild:function(){var b,c;return b=a.StackView.prototype.removeChild.apply(this,arguments),b&&(c=this._buttonMap[b.cid],this.buttonContainer.removeChild(c),delete this._buttonMap[b.cid]),b},showChild:function(b){var c,d;return b=a.StackView.prototype.showChild.apply(this,[b,!0]),b&&(c="selected",d=this._buttonMap,this._previousView&&d[this._previousView.cid].$el.removeClass(c),d[b.cid].$el.addClass(c)),b},getTabContent:function(a){return a._tabContentView}}),a.CloseTabButtonPlugin={tabButtonView:a.ActionView,tabButtonOptions:{attributes:{"class":"tab-button"},actions:[{iconClass:"tab-close",onClick:function(a){var b;b=this.tabView.getTabContent(this),this.tabView.removeChild(b),a.stopPropagation()}}]}},a.GoogleMapView=a.View.extend({apiKey:"",defaultLocation:{lat:-34.397,lng:150.644},subscribers:{GOOGLE_MAP_SCRIPT_LOADED:"_onScriptLoaded"},initialize:function(b){a.View.prototype.initialize.apply(this,arguments),b.el||this.$el.css({width:"100%",height:"100%"})},initMap:function(){var a;if(!this.apiKey||0===this.apiKey.length)throw new Error("You need Google Map API key to use this widget");this._mapInit||(a=document.createElement("script"),a.type="text/javascript",a.src="http://maps.googleapis.com/maps/api/js?sensor=true&callback=Backpack.GoogleMapView.onScriptLoaded&key="+this.apiKey,document.body.appendChild(a),this._mapInit=!0)},_onScriptLoaded:function(){this.map=new google.maps.Map(this.$el.get(0),{zoom:8,center:new google.maps.LatLng(this.defaultLocation.lat,this.defaultLocation.lng),mapTypeId:google.maps.MapTypeId.ROADMAP}),this.removeSubscriber("GOOGLE_MAP_SCRIPT_LOADED",this._onScriptLoaded)},setLocation:function(a){this.map.panTo(new google.maps.LatLng(a.lat,a.lng))},addMarker:function(a){var b;b=new google.maps.Marker({position:new google.maps.LatLng(a.lat,a.lng),title:a.title}),b.setMap(this.map)}}),a.GoogleMapView.onScriptLoaded=function(){Backbone.trigger("GOOGLE_MAP_SCRIPT_LOADED")}}).call(this);