(function(){var a,b,c,d,e,f,g,h={}.hasOwnProperty;f=this,a=f.Backpack={},a.attach=function(){var a,b,c,d,e;switch(d=arguments[0],c=arguments[1],arguments.length){case 3:a=arguments[2];break;case 4:b=arguments[2],a=_.isString(arguments[3])?b[arguments[3]]:arguments[3]}return e=d[c],d[c]=function(){var c;return c=e.apply(d,arguments),b||(b=this),a&&a.apply(b,arguments),c},{detach:function(){d[c]=e}}},a.defaultPlugins=[],c=function(b,c){var d,e,f,g;null==c&&(c={}),c.allPlugins?f=c.allPlugins:(f=b.allPlugins||[],c.plugins&&(f=f.concat(c.plugins))),f=_.clone(a.defaultPlugins).concat(f),b.setups=[],b.cleanups=[],e={},_.each(f,function(a){var c,d;for(c in a)h.call(a,c)&&(d=a[c],"setup"!==c&&"cleanup"!==c&&"staticProps"!==c&&(e[c]=d));a.setup&&b.setups.push(a.setup),a.cleanup&&b.cleanups.push(a.cleanup)});for(d in e)h.call(e,d)&&(g=e[d],b[d]||(b[d]=g));for(d in c)h.call(c,d)&&(g=c[d],"plugins"!==d&&"initialize"!==d&&(b[d]=g))},g=function(a){_.each(a.setups,function(b){b.apply(a)})},d=function(a){_.each(a.cleanups,function(b){b.apply(a)})},e=function(a,b){var c,d;return c=Backbone.Model.extend.call(this,a,b),a&&(d=a.allPlugins,d?c.prototype.allPlugins=d:(d=a.plugins,d&&(c.prototype.allPlugins=c.prototype.allPlugins?c.prototype.allPlugins.concat(d):d)),d&&_.each(d,function(a){a.staticProps&&_.extend(c,a.staticProps)})),c.prototype.plugins||(c.prototype.plugins=[]),c},b=a.Class=function(){this.cid=_.uniqueId("obj"),this.initialize.apply(this,arguments)},_.extend(b.prototype,Backbone.Events,{initialize:function(){var a;a=arguments.length>0?arguments[arguments.length-1]:{},c(this,a),g(this),(null!=a?a.initialize:void 0)&&a.initialize.apply(this,arguments)},destroy:function(){d(this)}}),b.extend=e,a.Model=Backbone.Model.extend({initialize:function(a,b){c(this,b),g(this),(null!=b?b.initialize:void 0)&&b.initialize.apply(this,arguments)},destroy:function(){d(this),Backbone.Model.prototype.destroy.apply(this,arguments)}}),a.Model.extend=e,a.Collection=Backbone.Collection.extend({initialize:function(a,b){c(this,b),g(this),(null!=b?b.initialize:void 0)&&b.initialize.apply(this,arguments)},destroy:function(){d(this)}}),a.Collection.extend=e,a.View=Backbone.View.extend({initialize:function(a){c(this,a),g(this),(null!=a?a.initialize:void 0)&&a.initialize.apply(this,arguments)},delegateEvents:function(a){var b,c,d,e,f,g,i,j=this;if(!a&&!(a=_.result(this,"events")))return this;this.undelegateEvents(),b=function(a){var b;return b=function(b){return j[a](b)},_.bind(b,j)};for(d in a)h.call(a,d)&&(g=a[d],(this[g]&&_.isFunction(this[g])||_.isFunction(g))&&(e=d.match(/^(\S+)\s*(.*)$/),c=e[1],i=e[2],f=_.isFunction(g)?g:b(g),c+=".delegateEvents"+this.cid,""===i?this.$el.on(c,f):this.$el.on(c,i,f)));return this},remove:function(){d(this),Backbone.View.prototype.remove.apply(this,arguments)},destroy:function(){this.remove()}}),a.View.extend=e,a.AttachPlugin={setup:function(){this._attached=[]},attach:function(){var b;switch(arguments.length){case 2:b=a.attach(this,arguments[0],arguments[1]);break;case 3:b=a.attach(arguments[0],arguments[1],arguments[2])}return this._attached.push(b),b},detach:function(a){var b,c;return b=_.indexOf(this._attached,a),c=!1,-1!==b&&(this._attached.splice(b,1),a.detach(),c=!0),c},cleanup:function(){_.invoke(this._attached,"detach"),this._attached=[]}},a.defaultPlugins.push(a.AttachPlugin),a.SubscribePlugin={setup:function(){var a,b,c;if(this._subscribers=[],this.subscribers){c=this.subscribers;for(a in c)h.call(c,a)&&(b=c[a],this.addSubscriber(a,b))}},addSubscriber:function(a,b){return _.isString(b)&&(b=this[b]),this._subscribers.push({topic:a,callback:b}),Backbone.on(a,b,this)},removeSubscriber:function(a,b){var c,d,e,f,g;for(_.isString(b)&&(b=this[b]),c=-1,g=this._subscribers,d=f=g.length-1;f>=0;d=f+=-1)if(e=g[d],a===e.topic&&b===e.callback){c=d;break}return c>=0?(-1!==c&&this._subscribers.splice(c,1),Backbone.off(a,b,this),!0):!1},cleanup:function(){var a=this;_.each(this._subscribers,function(b){return Backbone.off(b.topic,b.callback,a)}),this._subscribers=[]}},a.defaultPlugins.push(a.SubscribePlugin),a.PublishPlugin={setup:function(){var a,b,c;if(this._publishers=[],this.publishers){c=this.publishers;for(a in c)h.call(c,a)&&(b=c[a],this.addPublisher(a,b))}},addPublisher:function(b,c){var d;return d=a.attach(this,b,function(){var a;a=[].slice.call(arguments,0),a.unshift(c),Backbone.trigger.apply(Backbone,a)}),this._publishers.push({handler:d,method:b,topic:c}),d},removePublisher:function(){var a,b,c,d,e;for(a=-1,e=this._publishers,b=d=e.length-1;d>=0;b=d+=-1)if(c=e[b],arguments.length>1&&_.isString(arguments[0])){if(arguments[0]===c.method&&arguments[1]===c.topic){a=b;break}}else if(arguments[0]===c.handler){a=b;break}return a>=0?(this._publishers[a].handler.detach(),this._publishers.splice(a,1),!0):!1},cleanup:function(){_.each(this._publishers,function(a){a.handler.detach()}),this._publishers=[]}},a.defaultPlugins.push(a.PublishPlugin)}).call(this);